<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Retro DV Camera</title>
    <style>
        :root { --ios-red: #ff3b30; --ios-yellow: #f7d51d; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', Courier, monospace; overflow: hidden; color: white; }
        
        /* è¢å¹•é è¦½å€åŸŸ */
        #viewport { position: relative; width: 100%; height: 100%; overflow: hidden; display: flex; align-items: center; }
        
        /* ç•«è³ªè™•ç†ï¼šæ•…æ„é™ä½ä¸€é»æ¸…æ™°åº¦ä¸¦å¢åŠ è‰²å½©åå‘ */
        video { 
            width: 100%; height: 100%; object-fit: cover; 
            filter: contrast(1.1) brightness(1.1) saturate(1.2) sepia(0.1);
            transition: transform 0.1s ease-out;
        }

        /* 1. å¾©å¤æƒæç·šèˆ‡è‰²å½©åç§»å±¤ */
        .dv-fx { 
            position: absolute; inset: 0; pointer-events: none; z-index: 2;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%); 
            background-size: 100% 3px; 
            opacity: 0.4; 
        }

        /* 2. å‹•æ…‹å™ªé»å±¤ (Retro Noise) */
        .noise {
            position: absolute; inset: 0; z-index: 3; pointer-events: none;
            background-image: url("https://media.giphy.com/media/oEI9uWUicKgH6/giphy.gif"); /* æ¨¡æ“¬é›ªèŠ±å™ªé» */
            opacity: 0.05;
            mix-blend-mode: overlay;
        }

        /* UI æ–‡å­— - ç¶“å…¸æ•¸ç¢¼é»ƒ */
        .ui-text {
            position: absolute; font-family: 'Courier New', Courier, monospace;
            color: var(--ios-yellow); text-shadow: 2px 2px #000; z-index: 4; font-weight: bold;
        }
        .rec-dot { top: 50px; left: 20px; color: var(--ios-red); display: none; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }
        
        .timestamp { bottom: 180px; left: 20px; line-height: 1.2; font-size: 1.1rem; }
        .battery { top: 50px; right: 20px; }

        /* Zoom æ§åˆ¶ */
        .zoom-wrap { position: absolute; right: 15px; top: 40%; transform: translateY(-50%); display: flex; flex-direction: column; align-items: center; z-index: 10; }
        .zoom-slider { appearance: none; -webkit-appearance: none; width: 150px; height: 2px; background: rgba(255,255,255,0.4); transform: rotate(-90deg); margin: 70px 0; }
        .zoom-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: white; }

        /* æ¨¡å¼åˆ‡æ› */
        .mode-selector { position: absolute; bottom: 130px; width: 100%; display: flex; justify-content: center; gap: 40px; z-index: 5; font-family: -apple-system; font-weight: bold; }
        .mode { color: rgba(255,255,255,0.4); font-size: 14px; transition: 0.3s; }
        .mode.active { color: var(--ios-yellow); transform: scale(1.1); }

        /* åº•éƒ¨æ§åˆ¶æ¬„ */
        .controls { position: absolute; bottom: 0; width: 100%; height: 120px; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); display: flex; align-items: center; justify-content: space-around; z-index: 5; padding-bottom: env(safe-area-inset-bottom); border-top: 1px solid rgba(255,255,255,0.1); }
        .btn-side { width: 45px; height: 45px; border-radius: 50%; background: rgba(255,255,255,0.1); border: none; color: white; font-size: 20px; }
        
        .shutter-btn { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 4px; border: none; }
        .shutter-inner { width: 100%; height: 100%; border-radius: 50%; transition: 0.2s; }
        .mode-video .shutter-inner { background: var(--ios-red); }
        .mode-photo .shutter-inner { background: #eee; border: 2px solid #333; }
        .recording .shutter-inner { border-radius: 6px; transform: scale(0.6); }

        /* é è¦½é®ç½© */
        #preview-layer { position: fixed; inset: 0; background: #000; z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="viewport">
        <div class="ui-text rec-dot" id="rec-indicator">â— REC</div>
        <div class="ui-text battery">F 12  [â– â– â– ]</div>
        <div class="dv-fx"></div>
        <div class="noise"></div>
        <div class="ui-text timestamp" id="ts"></div>
        
        <video id="v" autoplay playsinline muted></video>

        <div class="zoom-wrap ui-text" style="text-shadow: none;">
            <span id="zoom-txt">1.0x</span>
            <input type="range" class="zoom-slider" id="z" min="1" max="4" step="0.1" value="1">
            <span>ZOOM</span>
        </div>

        <div class="mode-selector">
            <span class="mode active" id="mode-video" onclick="setMode('video')">VIDEO</span>
            <span class="mode" id="mode-photo" onclick="setMode('photo')">PHOTO</span>
        </div>

        <div class="controls mode-video" id="ctrl-bar">
            <button class="btn-side" onclick="switchCam()">ğŸ”„</button>
            <button class="shutter-btn" onclick="handleAction()">
                <div class="shutter-inner" id="shutter-ui"></div>
            </button>
            <button class="btn-side" onclick="alert('éŒ„å½±/æ‹ç…§å¾Œé•·æŒ‰å„²å­˜è‡³ç›¸ç°¿')">ğŸï¸</button>
        </div>
    </div>

    <div id="preview-layer">
        <div id="media-container" style="width: 90%; text-align: center;"></div>
        <p style="color: var(--ios-yellow); margin: 20px 0; font-family: 'Courier New';">LONG PRESS TO SAVE</p>
        <button onclick="closePreview()" style="background: transparent; color: white; border: 1px solid white; padding: 10px 30px; border-radius: 5px; font-family: 'Courier New';">BACK</button>
    </div>

    <script>
        const v = document.getElementById('v');
        const ts = document.getElementById('ts');
        const z = document.getElementById('z');
        const zTxt = document.getElementById('zoom-txt');
        const ctrlBar = document.getElementById('ctrl-bar');
        
        let currentMode = 'video';
        let facingMode = "environment";
        let recorder, chunks = [], isRec = false;

        async function init() {
            if(window.stream) window.stream.getTracks().forEach(t => t.stop());
            const s = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: facingMode, width: 1280 }, 
                audio: true 
            });
            v.srcObject = s;
            window.stream = s;
        }

        function setMode(m) {
            if (isRec) return;
            currentMode = m;
            document.querySelectorAll('.mode').forEach(el => el.classList.remove('active'));
            document.getElementById(`mode-${m}`).classList.add('active');
            ctrlBar.className = `controls mode-${m}`;
        }

        function handleAction() {
            if (currentMode === 'video') toggleRec();
            else takePhoto();
        }

        function takePhoto() {
            const canvas = document.createElement('canvas');
            canvas.width = v.videoWidth; canvas.height = v.videoHeight;
            const ctx = canvas.getContext('2d');
            const scale = parseFloat(z.value);
            const w = canvas.width / scale;
            const h = canvas.height / scale;
            const x = (canvas.width - w) / 2;
            const y = (canvas.height - h) / 2;
            ctx.filter = "contrast(1.1) saturate(1.2) sepia(0.2)";
            ctx.drawImage(v, x, y, w, h, 0, 0, canvas.width, canvas.height);
            showPreview(canvas.toDataURL('image/jpeg'), 'photo');
        }

        function toggleRec() {
            if (!isRec) {
                chunks = [];
                recorder = new MediaRecorder(window.stream, { mimeType: 'video/mp4' });
                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/mp4' });
                    showPreview(URL.createObjectURL(blob), 'video');
                };
                recorder.start();
                document.getElementById('rec-indicator').style.display = 'block';
                ctrlBar.classList.add('recording');
                isRec = true;
            } else {
                recorder.stop();
                document.getElementById('rec-indicator').style.display = 'none';
                ctrlBar.classList.remove('recording');
                isRec = false;
            }
        }

        function showPreview(url, type) {
            const container = document.getElementById('media-container');
            container.innerHTML = type === 'video' 
                ? `<video src="${url}" style="width:100%;" id="preview-content" controls autoplay></video>`
                : `<img src="${url}" style="width:100%;" id="preview-content">`;
            document.getElementById('preview-layer').style.display = 'flex';
        }

        function closePreview() {
            document.getElementById('preview-layer').style.display = 'none';
            document.getElementById('media-container').innerHTML = '';
        }

        function switchCam() { facingMode = facingMode === "user" ? "environment" : "user"; init(); }

        z.oninput = () => {
            v.style.transform = `scale(${z.value})`;
            zTxt.innerText = `${parseFloat(z.value).toFixed(1)}x`;
        };

        setInterval(() => {
            const d = new Date();
            const m = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            ts.innerHTML = `${m[d.getMonth()]} ${String(d.getDate()).padStart(2,'0')} ${d.getFullYear()}<br>${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
        }, 1000);

        init();
    </script>
</body>
</html>
